<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Countdown Timer Test - Autobidder</title>
    <link href="/assets/css/enhanced-countdown.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .test-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
        }
        
        .device-info {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-btn.secondary {
            background: #6c757d;
        }
        
        .countdown-container {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h2>Mobile Countdown Timer Test</h2>
            <p>Testing the market open/close countdown timer on mobile devices</p>
            <div class="device-info" id="device-info">
                Loading device information...
            </div>
        </div>
        
        <div class="countdown-container">
            <div id="countdown-test" data-time="">
                <div class="enhanced-countdown-container">
                    <div class="countdown-header">
                        <h3 class="countdown-title">Initializing...</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-buttons">
            <button class="test-btn" onclick="startTestCountdown(5)">5 Min Test</button>
            <button class="test-btn" onclick="startTestCountdown(60)">1 Hour Test</button>
            <button class="test-btn" onclick="startTestCountdown(1440)">1 Day Test</button>
            <button class="test-btn secondary" onclick="testSafariParsing()">Safari Test</button>
            <button class="test-btn secondary" onclick="testLineBreaking()">Line Break Test</button>
            <button class="test-btn secondary" onclick="testLabelVisibility()">Label Test</button>
        </div>
        
        <div id="debug-info" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; display: none;">
            <strong>Debug Information:</strong>
            <div id="debug-content"></div>
        </div>
    </div>

    <script>
        // Display device information
        function displayDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                viewportWidth: window.innerWidth,
                viewportHeight: window.innerHeight,
                devicePixelRatio: window.devicePixelRatio || 1,
                isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
                isSafari: /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)
            };
            
            document.getElementById('device-info').innerHTML = `
                <strong>Device:</strong> ${info.platform}<br>
                <strong>Screen:</strong> ${info.screenWidth}x${info.screenHeight}<br>
                <strong>Viewport:</strong> ${info.viewportWidth}x${info.viewportHeight}<br>
                <strong>Pixel Ratio:</strong> ${info.devicePixelRatio}<br>
                <strong>iOS:</strong> ${info.isIOS ? 'Yes' : 'No'}<br>
                <strong>Safari:</strong> ${info.isSafari ? 'Yes' : 'No'}
            `;
        }
        
        // Function to pad numbers with leading zeros
        const padNumber = (num) => num.toString().padStart(2, '0');
        
        // Function to create the enhanced countdown HTML structure
        const createCountdownHTML = (days, hours, minutes, seconds) => {
            const daysStr = padNumber(days);
            const hoursStr = padNumber(hours);
            const minutesStr = padNumber(minutes);
            const secondsStr = padNumber(seconds);
            
            return `
                <div class="enhanced-countdown-container">
                    <div class="countdown-header">
                        <h3 class="countdown-title">TIME REMAINING</h3>
                    </div>
                    <div class="countdown-digits">
                        <div class="countdown-unit">
                            <div class="countdown-digits-group">
                                <div class="countdown-digit days" data-digit="days-tens">${daysStr[0]}</div>
                                <div class="countdown-digit days" data-digit="days-ones">${daysStr[1]}</div>
                            </div>
                            <div class="countdown-label" data-short="D">DAYS</div>
                        </div>
                        <div class="countdown-separator">:</div>
                        <div class="countdown-unit">
                            <div class="countdown-digits-group">
                                <div class="countdown-digit hours" data-digit="hours-tens">${hoursStr[0]}</div>
                                <div class="countdown-digit hours" data-digit="hours-ones">${hoursStr[1]}</div>
                            </div>
                            <div class="countdown-label" data-short="H">HOURS</div>
                        </div>
                        <div class="countdown-separator">:</div>
                        <div class="countdown-unit">
                            <div class="countdown-digits-group">
                                <div class="countdown-digit minutes" data-digit="minutes-tens">${minutesStr[0]}</div>
                                <div class="countdown-digit minutes" data-digit="minutes-ones">${minutesStr[1]}</div>
                            </div>
                            <div class="countdown-label" data-short="M">MINS</div>
                        </div>
                        <div class="countdown-separator">:</div>
                        <div class="countdown-unit">
                            <div class="countdown-digits-group">
                                <div class="countdown-digit seconds" data-digit="seconds-tens">${secondsStr[0]}</div>
                                <div class="countdown-digit seconds" data-digit="seconds-ones">${secondsStr[1]}</div>
                            </div>
                            <div class="countdown-label" data-short="S">SECS</div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        // Function to update individual digits with flip animation
        const updateDigits = (days, hours, minutes, seconds) => {
            const daysStr = padNumber(days);
            const hoursStr = padNumber(hours);
            const minutesStr = padNumber(minutes);
            const secondsStr = padNumber(seconds);
            
            const digitUpdates = {
                'days-tens': daysStr[0],
                'days-ones': daysStr[1],
                'hours-tens': hoursStr[0],
                'hours-ones': hoursStr[1],
                'minutes-tens': minutesStr[0],
                'minutes-ones': minutesStr[1],
                'seconds-tens': secondsStr[0],
                'seconds-ones': secondsStr[1]
            };
            
            // Update each digit with animation if it changed
            Object.entries(digitUpdates).forEach(([digitType, newValue]) => {
                const digitElement = document.querySelector(`[data-digit="${digitType}"]`);
                if (digitElement && digitElement.textContent !== newValue) {
                    digitElement.classList.add('flip-in');
                    digitElement.textContent = newValue;
                    
                    // Remove animation class after animation completes
                    setTimeout(() => {
                        digitElement.classList.remove('flip-in');
                    }, 300);
                }
            });
        };
        
        function startTestCountdown(minutes) {
            const targetTime = new Date().getTime() + (minutes * 60 * 1000);
            let isInitialized = false;
            
            const debugDiv = document.getElementById('debug-info');
            const debugContent = document.getElementById('debug-content');
            debugDiv.style.display = 'block';
            
            const interval = setInterval(function() {
                const now = new Date().getTime();
                const distance = targetTime - now;
                
                if (distance < 0) {
                    clearInterval(interval);
                    document.getElementById('countdown-test').innerHTML = `
                        <div class="enhanced-countdown-container countdown-ended">
                            <div class="countdown-header">
                                <h3 class="countdown-title">Test Completed!</h3>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Time calculations with safety checks
                const days = Math.max(0, Math.floor(distance / (1000 * 60 * 60 * 24))) || 0;
                const hours = Math.max(0, Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))) || 0;
                const minutes = Math.max(0, Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))) || 0;
                const seconds = Math.max(0, Math.floor((distance % (1000 * 60)) / 1000)) || 0;
                
                // Debug information
                debugContent.innerHTML = `
                    Distance: ${distance}<br>
                    Days: ${days}, Hours: ${hours}, Minutes: ${minutes}, Seconds: ${seconds}<br>
                    NaN Check: ${isNaN(days) || isNaN(hours) || isNaN(minutes) || isNaN(seconds) ? 'FAILED' : 'PASSED'}
                `;
                
                if (isNaN(days) || isNaN(hours) || isNaN(minutes) || isNaN(seconds)) {
                    console.warn('NaN values detected:', {days, hours, minutes, seconds, distance});
                    return;
                }
                
                if (!isInitialized) {
                    document.getElementById('countdown-test').innerHTML = createCountdownHTML(days, hours, minutes, seconds);
                    isInitialized = true;
                } else {
                    updateDigits(days, hours, minutes, seconds);
                }
            }, 1000);
        }
        
        function testSafariParsing() {
            const testDates = [
                '2024-12-25 15:30:00',
                '2024-12-25T15:30:00',
                '2024-12-25T15:30:00Z',
                '2024/12/25 15:30:00',
                new Date(Date.now() + 3600000).toISOString()
            ];
            
            const debugDiv = document.getElementById('debug-info');
            const debugContent = document.getElementById('debug-content');
            debugDiv.style.display = 'block';
            
            let results = '<strong>Safari Date Parsing Test:</strong><br>';
            
            testDates.forEach((dateStr, index) => {
                let parseResult = 'FAILED';
                let parsedValue = 'N/A';
                
                try {
                    const parsed = new Date(dateStr).getTime();
                    if (!isNaN(parsed)) {
                        parseResult = 'SUCCESS';
                        parsedValue = new Date(parsed).toLocaleString();
                    }
                } catch (error) {
                    parseResult = 'ERROR: ' + error.message;
                }
                
                results += `Test ${index + 1}: ${parseResult}<br>`;
                results += `Input: ${dateStr}<br>`;
                results += `Output: ${parsedValue}<br><br>`;
            });
            
            debugContent.innerHTML = results;
        }
        
        function testLineBreaking() {
            const debugDiv = document.getElementById('debug-info');
            const debugContent = document.getElementById('debug-content');
            debugDiv.style.display = 'block';
            
            // Start a countdown with various time values to test layout
            startTestCountdown(1440); // 1 day to test with large numbers
            
            // Check layout measurements
            setTimeout(() => {
                const container = document.querySelector('.countdown-digits');
                const units = document.querySelectorAll('.countdown-unit');
                
                if (container && units.length > 0) {
                    const containerWidth = container.offsetWidth;
                    const unitsWidth = Array.from(units).reduce((total, unit) => total + unit.offsetWidth, 0);
                    const gaps = (units.length - 1) * 3 + 3 * 2; // 3px gap between units + separators
                    const totalRequiredWidth = unitsWidth + gaps;
                    
                    let results = '<strong>Layout Line Break Test:</strong><br>';
                    results += `Container Width: ${containerWidth}px<br>`;
                    results += `Total Units Width: ${unitsWidth}px<br>`;
                    results += `Gaps Width: ${gaps}px<br>`;
                    results += `Total Required: ${totalRequiredWidth}px<br>`;
                    results += `Fits in one line: ${totalRequiredWidth <= containerWidth ? 'YES ✅' : 'NO ❌'}<br><br>`;
                    
                    // Check individual unit positions
                    const firstUnit = units[0];
                    const lastUnit = units[units.length - 1];
                    const firstTop = firstUnit.offsetTop;
                    const lastTop = lastUnit.offsetTop;
                    
                    results += `First unit top: ${firstTop}px<br>`;
                    results += `Last unit top: ${lastTop}px<br>`;
                    results += `Same line: ${firstTop === lastTop ? 'YES ✅' : 'NO ❌ - Line break detected!'}<br>`;
                    
                    debugContent.innerHTML = results;
                } else {
                    debugContent.innerHTML = 'Error: Countdown elements not found';
                }
            }, 2000);
        }
        
        function testLabelVisibility() {
            const debugDiv = document.getElementById('debug-info');
            const debugContent = document.getElementById('debug-content');
            debugDiv.style.display = 'block';
            
            // Start a countdown to test labels
            startTestCountdown(90); // 1.5 hours
            
            // Check label visibility
            setTimeout(() => {
                const labels = document.querySelectorAll('.countdown-label');
                const viewportWidth = window.innerWidth;
                
                let results = '<strong>Label Visibility Test:</strong><br>';
                results += `Viewport Width: ${viewportWidth}px<br><br>`;
                
                if (viewportWidth <= 375) {
                    results += `Expected: Abbreviations (D, H, M, S)<br>`;
                } else {
                    results += `Expected: Full labels (DAYS, HOURS, MINS, SECS)<br>`;
                }
                
                labels.forEach((label, index) => {
                    const labelNames = ['DAYS', 'HOURS', 'MINS', 'SECS'];
                    const computedStyle = window.getComputedStyle(label);
                    const fontSize = computedStyle.fontSize;
                    const isUsingAbbreviation = fontSize === '0px';
                    
                    results += `${labelNames[index]}: `;
                    if (isUsingAbbreviation) {
                        results += `Showing abbreviation ✅<br>`;
                    } else {
                        results += `Showing full text (font-size: ${fontSize}) ✅<br>`;
                    }
                });
                
                debugContent.innerHTML = results;
            }, 2000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            displayDeviceInfo();
            
            // Start a default 2-minute countdown
            setTimeout(() => {
                startTestCountdown(2);
            }, 1000);
        });
        
        // Update device info on resize
        window.addEventListener('resize', displayDeviceInfo);
    </script>
</body>
</html>